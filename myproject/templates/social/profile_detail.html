{% extends "social/base.html" %}
{% load static %}
{% block title %}Profile • {{ profile.user.username }}{% endblock %}
{% block content %}
<div class="row">
  <div class="col-lg-8 mx-auto">
    <div class="card mb-3">
      <div class="card-body d-flex align-items-center gap-3">
        <img class="avatar" style="width:72px;height:72px" src="{% if profile.photo %}{{ profile.photo.url }}{% else %}{% static 'default-avatar.png' %}{% endif %}">
        <div class="flex-grow-1">
          <h5 class="mb-1">
           {% if profile.full_name %}
              {{ profile.full_name }}
           {% else %}
              {{ profile.user.email }}
           {% endif %}
          </h5>

          <hr>

          
          <div class="text-muted">
            {{ user.email }}
            
            {{ profile.full_name }}
            
            {% if profile.major %} • {{ profile.major }}{% endif %}

            {% if profile.year %} • {{ profile.year }}{% endif %}

            {% if profile.roll_no %} • #{{ profile.roll_no }}{% endif %}
          </div>
          <div class="small text-muted">{{ profile.bio }}</div>
          <div class="mt-2 small">
            <span class="me-3">Posts: <strong>{{ profile.posts_count }}</strong></span>
            <a class="me-3" href="{% url 'social:followers-list' profile.user.id %}">Followers: <strong>{{ profile.followers_count }}</strong></a>
            <a class="me-3" href="{% url 'social:following-list' profile.user.id %}">Following: <strong>{{ profile.following_count }}</strong></a>
          </div>
        </div>
        {% if request.user.id != profile.user.id %}
        <button id="follow-btn" class="btn btn-primary" data-user="{{ profile.user.id }}">Follow / Unfollow</button>
        {% else %}
        <a class="btn btn-outline-secondary" href="{% url 'social:profile-edit' %}">Edit Profile</a>
        {% endif %}
      </div>
    </div>

    <h6 class="mb-3">Posts</h6>
    {% for post in profile.user.posts.all|dictsortreversed:'created_at' %}
      {% include "social/post_card.html" with post=post %}
    {% empty %}
      <div class="alert alert-light border">No posts yet.</div>
    {% endfor %}
  </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
const followBtn = document.getElementById('follow-btn');
if (followBtn) {
  followBtn.addEventListener('click', async () => {
    const uid = followBtn.dataset.user;
    const data = await postJSON("{% url 'social:follow-toggle' %}", {user_id: uid});
    // Optional: flash a toast or adapt button label using data.following
  });
}
</script>
{% endblock %}
