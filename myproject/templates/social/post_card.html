{# expects var: post #}
{% load static %}
<div class="card mb-3" id="post-card-{{ post.id }}">
  <div class="card-body">
    <div class="d-flex align-items-center gap-2 mb-2">
      <img class="avatar"
           src="{% if post.author.profile.photo %}{{ post.author.profile.photo.url }}{% else %}{% static 'default-avatar.png' %}{% endif %}"
           alt="">

      <div>
        <a class="fw-semibold text-decoration-none" href="{% url 'social:profile-detail' post.author.id %}">
          {% with prof=post.author.profile %}
            {% if prof and prof.full_name %}
              {{ prof.full_name }}
            {% else %}
              {{ post.author.email }}
            {% endif %}
          {% endwith %}
        </a>
        <div class="text-muted small">{{ post.created_at|timesince }} ago</div>
      </div>

      <div class="ms-auto">
        {% if request.user.id == post.author_id %}
          <a class="btn btn-sm btn-outline-primary" href="{% url 'social:post-edit' post.id %}">
            <i class="fa-regular fa-pen-to-square"></i>
          </a>

          <button type="button"
                  class="btn btn-outline-danger btn-sm"
                  data-bs-toggle="modal"
                  data-bs-target="#confirmDeleteModal-{{ post.id }}">
            <i class="fa-regular fa-trash-can me-1"></i>
          </button>
        {% endif %}
      </div>
    </div>

    <!-- Delete confirm modal -->
    <div class="modal fade" id="confirmDeleteModal-{{ post.id }}" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <form class="delete-post-form" data-post-id="{{ post.id }}"
                action="{% url 'social:post-delete' post.id %}" method="post">
            {% csrf_token %}
            <div class="modal-header">
              <h5 class="modal-title text-primary">UniSocial</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <p class="mb-0">Are you sure you want to delete this post?</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-danger">Delete</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <a href="{% url 'social:post-detail' post.id %}" class="text-decoration-none text-body">
      {% if post.text %}
        <p class="mb-2">{{ post.text|linebreaksbr }}</p>
      {% endif %}
      {% if post.photo %}
        <img src="{{ post.photo.url }}" alt="Post image"
             class="img-fluid rounded mb-2"
             style="object-fit: cover; max-height: 500px; width: 100%;">
      {% endif %}
    </a>

    <div class="card-footer d-flex align-items-center gap-3">
      <!-- Like -->
      <button class="btn btn-sm {% if post.is_liked %}btn-primary{% else %}btn-outline-primary{% endif %} like-btn"
              data-id="{{ post.id }}">
        {% if post.is_liked %}
          <i class="fa-solid fa-thumbs-up me-1"></i>
        {% else %}
          <i class="fa-regular fa-thumbs-up me-1"></i>
        {% endif %}
        <span class="badge bg-primary-subtle text-primary" id="like-count-{{ post.id }}">
          {{ post.likes_count }}
        </span>
      </button>

      <!-- (Optional) Save â€” enable if you wired /posts/<id>/save/ -->
      {% comment %}
      {# 
      <button class="btn btn-sm {% if post.is_saved %}btn-secondary{% else %}btn-outline-secondary{% endif %} save-btn"
              data-id="{{ post.id }}">
        {% if post.is_saved %}
          <i class="fa-solid fa-bookmark me-1"></i>
        {% else %}
          <i class="fa-regular fa-bookmark me-1"></i>
        {% endif %}
        <span class="badge bg-secondary-subtle text-secondary" id="save-count-{{ post.id }}">
          {{ post.saves_count }}
        </span>
      </button>
      #}
      {% endcomment %}

      <a class="btn btn-sm btn-outline-dark" href="{% url 'social:post-detail' post.id %}">
        <i class="fa-regular fa-comment"></i>
      </a>
      <span class="text-muted small">{{ post.comments_count }} comments</span>
    </div>
  </div>
</div>
